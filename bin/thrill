#!/usr/bin/env node
var app = require('commander'),
	vm = require('vm'),
	fs = require('fs'),
	thrillRunner = require('../').runner;

app.version('0.1.3')	

var filePath = './thrill.js'; // By default
app.command("*").action(function(configFilePath){
	filePath = configFilePath;
});

app.parse(process.argv);

(function(){
	var config = {};
	try {
		vm.runInNewContext(fs.readFileSync(filePath), config);
	} catch(e) {
		if (e.name === 'SyntaxError') {
		  console.error('Syntax error in config file!\n' + e.message);
		} else if (e.code === 'ENOENT' || e.code === 'EISDIR') {
		  console.error('Config file does not exist!');
		} else {
		  console.error('Invalid config file!\n', e);
		}

		process.exit(1);
	}
	thrillRunner(config);
}());
